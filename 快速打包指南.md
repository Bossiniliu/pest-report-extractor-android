# 🚀 快速打包指南

## 📱 将虫害报告提取器打包为 APK（最简方式）

### 方法一：使用自动脚本（推荐 - macOS）

```bash
# 1. 进入项目目录
cd "/Users/bossiniliu/Documents/Coding/Claude Code/Pest Report Extrator"

# 2. 运行打包脚本
./build_apk.sh
```

**就这么简单！** 脚本会自动：
- ✅ 检查 Docker 环境
- ✅ 准备打包文件
- ✅ 下载构建工具
- ✅ 编译生成 APK

---

### 方法二：手动 Docker 命令（macOS）

```bash
# 1. 确保 Docker Desktop 正在运行

# 2. 进入项目目录
cd "/Users/bossiniliu/Documents/Coding/Claude Code/Pest Report Extrator"

# 3. 创建 main.py
cp android_main.py main.py

# 4. 拉取镜像
docker pull kivy/buildozer:latest

# 5. 开始打包
docker run --rm -v "$PWD":/home/user/hostcwd kivy/buildozer android debug

# 6. 查找 APK
ls -lh bin/*.apk
```

---

### 方法三：使用 Linux 服务器

如果您有 Ubuntu 服务器或虚拟机：

```bash
# 1. 安装依赖（仅首次需要）
sudo apt update
sudo apt install -y python3-pip git zip unzip openjdk-11-jdk
pip3 install buildozer cython==0.29.33

# 2. 上传文件到服务器
# - android_main.py
# - buildozer.spec

# 3. 重命名文件
mv android_main.py main.py

# 4. 打包
buildozer android debug

# 5. 下载 APK
# bin/pestreportextractor-2.0-debug.apk
```

---

## 📋 前置要求

### macOS (Docker 方式)
- ✅ macOS 10.15+
- ✅ Docker Desktop（[下载地址](https://www.docker.com/products/docker-desktop)）
- ✅ 至少 10GB 可用磁盘空间
- ✅ 稳定的网络连接

### Linux 方式
- ✅ Ubuntu 20.04/22.04
- ✅ 8GB+ RAM
- ✅ 20GB+ 可用磁盘空间
- ✅ Python 3.8+

---

## ⏱️ 打包时间

| 阶段 | 首次 | 后续 |
|------|------|------|
| 下载构建工具 | 30-60 分钟 | - |
| 编译 APK | 30-60 分钟 | 10-20 分钟 |
| **总计** | **1-2 小时** | **10-20 分钟** |

---

## 📱 安装 APK

### 步骤：

1. **传输文件**
   - 通过 USB、云盘或邮件将 APK 传到手机
   - 文件位置：`bin/pestreportextractor-2.0-debug.apk`

2. **允许安装**
   - 设置 → 安全 → 允许安装未知应用
   - 选择您的文件管理器

3. **安装应用**
   - 在手机上找到 APK 文件
   - 点击安装

4. **授予权限**
   - 首次运行时授予存储权限

5. **开始使用**
   - 选择 PDF 文件
   - 点击"开始处理"
   - 查看生成的 Excel 报告

---

## 🎯 生成的文件位置

安装后，生成的 Excel 文件将保存在：

```
手机存储/Documents/虫害报告/
虫害情况报告_20250107_153045.xlsx
```

可以通过以下方式查看：
- 📂 文件管理器 → Documents → 虫害报告
- 📧 使用邮件应用发送
- ☁️ 上传到云盘

---

## ❓ 常见问题

### Q: Docker 下载很慢怎么办？

**A:** 配置 Docker 镜像加速：
```bash
# 编辑 Docker 配置
nano ~/.docker/daemon.json

# 添加镜像源
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn"
  ]
}

# 重启 Docker Desktop
```

### Q: 打包失败，显示 "Permission denied"

**A:** 
```bash
# 赋予脚本执行权限
chmod +x build_apk.sh

# 重新运行
./build_apk.sh
```

### Q: APK 安装后打不开

**A:** 检查：
1. 手机 Android 版本是否 ≥ 5.0
2. 是否授予了存储权限
3. 查看手机日志：`adb logcat | grep python`

### Q: 找不到生成的 Excel 文件

**A:** 
1. 打开手机"文件管理器"
2. 进入"内部存储" → "Documents" → "虫害报告"
3. 或者搜索 "虫害情况报告"

---

## 📁 项目文件说明

```
项目目录/
├── android_main.py          # ⭐ Android 版本主程序
├── buildozer.spec          # ⭐ 打包配置文件
├── build_apk.sh            # 🚀 自动打包脚本（推荐）
├── Android打包说明.md      # 📖 详细打包文档
├── 快速打包指南.md         # 📋 本文档
├── pest_report_extractor.py # 桌面版程序（参考）
└── README.md               # 项目总览
```

**关键文件：**
- `android_main.py` - 安卓版核心代码
- `buildozer.spec` - APK 配置（权限、依赖等）
- `build_apk.sh` - 一键打包脚本

---

## 🎨 界面预览

应用界面包含：
- 🐛 **标题栏** - "虫害报告提取器 v2.0"
- 📁 **选择按钮** - 浏览并选择 PDF 文件
- 🚀 **处理按钮** - 开始提取和生成
- 📊 **进度条** - 实时显示处理进度
- 📝 **状态区** - 显示详细的操作信息

**设计原则：**
- ✅ 简洁明了
- ✅ 大按钮易点击
- ✅ 清晰的状态反馈
- ✅ 适配竖屏操作

---

## 🔄 更新 APK

如果需要更新应用：

1. **修改代码** - 编辑 `android_main.py`
2. **更新版本** - 修改 `buildozer.spec` 中的版本号
3. **重新打包** - 运行 `./build_apk.sh`
4. **卸载旧版** - 在手机上卸载旧版应用
5. **安装新版** - 安装新生成的 APK

---

## 📞 获取帮助

详细文档请参考：
- 📖 `Android打包说明.md` - 完整的打包教程
- 📖 `README.md` - 项目总览和功能说明
- 📖 `使用说明.md` - 桌面版使用指南（可参考）

---

## ✅ 检查清单

开始打包前，请确认：

- [ ] Docker Desktop 已安装并运行
- [ ] 网络连接稳定
- [ ] 至少 10GB 可用空间
- [ ] 有 1-2 小时的等待时间
- [ ] 文件 `android_main.py` 存在
- [ ] 文件 `buildozer.spec` 存在

全部确认后，运行：
```bash
./build_apk.sh
```

---

**祝打包顺利！** 🎉📱✨

有问题请参考 `Android打包说明.md` 的常见问题章节。
