# 虫害情况数据提取工具使用说明 v2.0

## 📋 功能介绍

这个工具可以自动从虫害报告PDF中提取虫害数据，转换为Excel格式，**生成可视化分析报告**，并进行完整的数据验证。

## 🆕 v2.0 新功能

- ✨ **数据分析报告**：自动生成包含统计图表的分析报告
  - 数据概览（总记录数、虫害总数、平均密度、最大单点）
  - 虫害类型统计（记录数、总数量、占比）
  - 建筑物虫害统计（记录数、总数量、占比）
  - 高危区域TOP10分析

## 🔧 环境要求

### 必需的Python库
```bash
pip install pdfplumber openpyxl pandas
```

## 💻 使用方法

### 方法一：GUI模式（推荐在macOS/Windows上使用）

直接双击运行脚本，或在终端运行：
```bash
python pest_report_extractor.py
```

脚本会：
1. 弹出文件选择对话框，选择PDF文件
2. 自动提取数据并生成Excel
3. **询问是否生成分析报告**
4. 询问是否打开生成的文件

### 方法二：命令行模式

适合批量处理或自动化场景：

#### 基本用法
```bash
python pest_report_extractor.py --pdf <PDF文件路径>
```

#### 生成分析报告（新功能）
```bash
python pest_report_extractor.py --pdf report.pdf --report
```

#### 指定输出目录
```bash
python pest_report_extractor.py --pdf report.pdf --output ~/Desktop
```

#### 自动打开生成的Excel
```bash
python pest_report_extractor.py --pdf report.pdf --open
```

#### 完整示例（推荐）
```bash
python pest_report_extractor.py --pdf "玉溪沃安疫苗产业园管理有限公司-泽润2025_10_25.pdf" --output ~/Documents --report --open
```

## 📊 输出说明

生成的Excel文件包含**两个工作表**：

### 工作表1：虫害情况（原始数据）
包含以下字段：
- **建筑物**：虫害发现的建筑物名称
- **楼层**：具体楼层
- **部门**：所属部门
- **检查/发现监测点位**：具体监测点编号
- **虫害类型**：虫害种类（如绿化飞虫、飞蛾、蚊子、苍蝇等）
- **发现虫害活动**：发现的虫害数量

### 工作表2：数据分析报告（新增）
包含以下分析内容：

#### 1. 数据概览
- 总记录数
- 虫害总数
- 平均密度（只/处）
- ⚠️ 最大单点（高亮显示）

#### 2. 虫害类型统计表
- 虫害类型
- 记录数
- 总数量（只）
- 占比（%）

#### 3. 建筑物虫害统计表
- 建筑物
- 记录数
- 总数量（只）
- 占比（%）

#### 4. 高危区域分析 - TOP 10
- 排名
- 建筑物
- 楼层
- 部门
- 监测点位
- 虫害类型
- 数量
（前三名会高亮显示）

## ✅ 自动验证功能

脚本会自动执行以下验证：

1. **记录数量验证**：确保提取数据与Excel数据数量一致
2. **字段完整性验证**：检查所有必要字段是否存在
3. **数据完整性验证**：检测是否有空值
4. **逐条数据验证**：对比原始数据和Excel数据是否一致
5. **统计信息验证**：提供按建筑物和虫害类型的统计分布

## 🎯 使用示例

### macOS示例
```bash
# 在桌面生成Excel文件（包含分析报告）
python pest_report_extractor.py --pdf ~/Downloads/虫害报告.pdf --output ~/Desktop --report --open

# 使用GUI模式选择文件
python pest_report_extractor.py

# 不生成报告，仅提取数据
python pest_report_extractor.py --pdf ~/Downloads/虫害报告.pdf
```

### Windows示例
```bash
# 在文档目录生成Excel文件（包含报告）
python pest_report_extractor.py --pdf "C:\Users\Username\Downloads\虫害报告.pdf" --output "C:\Users\Username\Documents" --report

# 批量处理（生成报告）
for %f in (*.pdf) do python pest_report_extractor.py --pdf "%f" --report
```

## 🎨 报告样式说明

生成的分析报告具有以下特点：
- **清晰的数据概览**：关键指标一目了然
- **统计表格**：带边框和表头样式
- **高亮显示**：重点数据（如最大单点、TOP3）使用颜色标记
- **专业格式**：适合直接用于汇报和分析

## 📝 注意事项

1. **仅提取"发现虫害活动"的记录**：标记为"无"或"低"的检查记录不会被提取
2. **文件命名**：生成的Excel文件自动添加时间戳，格式为：`虫害情况报告_YYYYMMDD_HHMMSS.xlsx`
3. **默认输出位置**：如果不指定输出目录，文件将保存在桌面
4. **支持的PDF格式**：需要PDF包含可提取的文本（不支持纯图片PDF）

## ❓ 常见问题

### Q: 提取了0条记录？
A: 可能原因：
- PDF为扫描版（纯图片），需要先进行OCR
- PDF格式不标准，建议检查"虫害情况"部分是否有标准格式

### Q: 部分数据未提取？
A: 脚本只提取明确标记为"发现虫害活动 - 数字"格式的记录。描述性记录（如"低"、"少量"）需要手动处理。

### Q: 如何批量处理多个PDF？
A: 可以使用shell脚本循环调用：
```bash
for file in *.pdf; do
    python pest_report_extractor.py --pdf "$file" --output ./results
done
```

## 📞 技术支持

如遇到问题，请提供：
1. PDF文件样本
2. 错误信息截图
3. 运行环境（操作系统、Python版本）

---

版本：1.0
更新日期：2025-11-07
